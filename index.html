<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Экстрактор артикулов — Tirika / Ozon</title>
  <link rel="icon" type="image/svg+xml" href="icon.svg"/>
  <style>
    :root {
      --bg: #0b1020;
      --card: #121936;
      --ink: #e9ecf1;
      --muted: #9aa3b2;
      --brand: #7c5cff;
      --brand-2: #00e0a4;
      --danger: #ff5d6c;
      --outline: rgba(255,255,255,.15);
    }
    * { box-sizing: border-box }
    body {
      margin: 0; font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu;
      color: var(--ink);
      background: radial-gradient(1200px 600px at 10% -10%, #1b2352 0%, transparent 70%), radial-gradient(1000px 500px at 110% 10%, #0d6a61 0%, transparent 60%), var(--bg);
    }
    .wrap { max-width: 1100px; margin: 32px auto; padding: 0 20px }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px }
    h1 { font-size: 28px; margin: 0; font-weight: 800 }
    .badge { background: linear-gradient(90deg,var(--brand),var(--brand-2)); color: #0d1020; font-weight: 700; padding: 4px 10px; border-radius: 999px; font-size: 12px }

    .grid { display: grid; grid-template-columns: 1fr; gap: 14px }
    @media (min-width: 960px) { .grid { grid-template-columns: 1fr 1fr } }

    .card { background: color-mix(in oklab, var(--card) 94%, #fff 0%); border: 1px solid rgba(255,255,255,.1); border-radius: 20px; padding: 16px; box-shadow: 0 8px 24px rgba(0,0,0,.25); }

    textarea { width: 100%; min-height: 300px; background: #0c1430; color: var(--ink); border: 1px solid rgba(255,255,255,.1); border-radius: 14px; padding: 14px; font: 14px/1.5 monospace; resize: vertical; outline: none; }

    .controls { display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-end; margin-top: 8px }

    button { border: none; border-radius: 10px; padding: 8px 14px; font-weight: 700; cursor: pointer; transition: all .2s; }
    .btn-main { background: linear-gradient(90deg,var(--brand),var(--brand-2)); color: #0d1020; }
    .btn-ghost { background: transparent; border: 1px solid var(--outline); color: var(--ink); }
    .btn-danger { background: var(--danger); color: white; }

    .info { font-size: 13px; color: var(--muted); margin-top: 8px; }
    .removed { color: #ff7878; font-size: 12px; margin-top: 4px; white-space: pre-wrap; }

    footer { text-align: center; margin-top: 20px; color: var(--muted); font-size: 13px; }
  
    /* additions: fixed background layer + logo styles */
    html,body{height:100%}
    html{background:var(--bg)}
    body::before{content:""; position:fixed; inset:0; z-index:-1; background:
      radial-gradient(1200px 600px at 10% -10%, #1b2352 0%, transparent 70%),
      radial-gradient(1000px 500px at 110% 10%, #0d6a61 0%, transparent 60%),
      var(--bg);
      pointer-events:none}
    .brand{display:flex; align-items:center; gap:12px}
    .logo{width:28px; height:28px; display:inline-block; border-radius:6px; object-fit:contain}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand"><img src="icon.svg" alt="" class="logo" onerror="this.style.display='none'"/><h1>Экстрактор артикулов <span class="badge">Tirika · Ozon</span></h1></div>
      <div>
        <label><input type="radio" name="mode" value="lines" checked> Для Тирики</label>
        <label><input type="radio" name="mode" value="semicolon"> Для Ozon</label>
        <label style="margin-left:10px"><input type="checkbox" id="dedupe" checked> Без дубликатов</label>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <label for="in">Вставьте текст с двумя столбцами</label>
        <textarea id="in" placeholder="Пример:\nNissan   39100-00Q6J\nRenault  391004571R"></textarea>
        <div class="controls">
          <button id="btn-paste" class="btn-ghost">Вставить</button>
          <button id="btn-clear" class="btn-danger">Очистить</button>
        </div>
      </section>

      <section class="card">
        <label for="out">Результат</label>
        <textarea id="out" readonly placeholder="Здесь появится результат..."></textarea>
        <div class="controls">
          <button id="btn-copy" class="btn-main">Копировать</button>
          <button id="btn-download" class="btn-ghost">Скачать .txt</button>
        </div>
        <div id="info" class="info"></div>
        <div id="removed" class="removed"></div>
      </section>
    </div>

    <footer>made by ahiok</footer>
  </div>

  <script>
    const $ = s => document.querySelector(s);
    const input = $('#in');
    const out = $('#out');
    const btnPaste = $('#btn-paste');
    const btnClear = $('#btn-clear');
    const btnCopy = $('#btn-copy');
    const btnDownload = $('#btn-download');
    const info = $('#info');
    const removedBox = $('#removed');

    function extractCodes(raw){
      const lines = raw.split(/\r?\n/);
      const codes = [];
      for(const line of lines){
        const parts = line.trim().split(/\s+/);
        const token = parts.pop()?.replace(/[^A-Za-z0-9]/g, '') ?? '';
        if(token) codes.push(token.toUpperCase());
      }
      return codes;
    }

    function uniqueStable(arr){
      const seen = new Set();
      const removed = [];
      const result = [];
      for(const item of arr){
        if(!seen.has(item)){
          seen.add(item);
          result.push(item);
        } else {
          removed.push(item);
        }
      }
      return { result, removed };
    }

    function format(codes, mode){
      return mode === 'semicolon' ? codes.join(';') : codes.join('\n');
    }

    function run(){
      const mode = document.querySelector('input[name="mode"]:checked').value;
      let list = extractCodes(input.value);
      const dedupe = $('#dedupe').checked;
      let removed = [];
      if(dedupe){
        const {result, removed: rm} = uniqueStable(list);
        list = result;
        removed = rm;
      }
      out.value = format(list, mode);
      info.textContent = `Всего: ${extractCodes(input.value).length}  ·  Уникальных: ${list.length}`;
      removedBox.textContent = removed.length ? `Удалены дубликаты: ${removed.join(', ')}` : '';
    }

    function copy(){
      navigator.clipboard.writeText(out.value);
    }

    function download(){
      const blob = new Blob([out.value], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'codes.txt'; a.click(); URL.revokeObjectURL(url);
    }

    btnPaste.onclick = async ()=>{ input.value = await navigator.clipboard.readText(); run(); };
    btnClear.onclick = ()=>{ input.value=''; out.value=''; info.textContent=''; removedBox.textContent=''; };
    btnCopy.onclick = copy;
    btnDownload.onclick = download;
    input.addEventListener('input', run);
    document.querySelectorAll('input[name="mode"], #dedupe').forEach(el=>el.addEventListener('change', run));
  </script>
</body>
</html>
